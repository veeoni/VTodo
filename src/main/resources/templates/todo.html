<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>代办列表</title>
    <link rel="stylesheet prefetch" href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css">
    <link rel='stylesheet prefetch' href='https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/components/icon.min.css'>
    <link rel="stylesheet  prefetch" href="../static/css/me.css" th:href="@{/css/me.css}"/>
</head>
<body>

<!--导航-->
<nav th:replace="_fragments :: menu(6)" class="ui inverted attached segment m-padded-tb-mini m-shadow-small">
    <div class="ui container">
        <!--stackable 屏幕小时可堆叠-->
        <div class="ui inverted stackable secondary menu">
            <h2 class="ui teal header item">VTodo</h2>
            <a class="active m-item item m-mobile-hide" href="javascript:;"><i class="home icon"></i>首页</a>
            <a class="m-item item m-mobile-hide" href="javascript:;"><i class="idea icon"></i>分类</a>
            <a class="m-item item m-mobile-hide" href="javascript:;"><i class="tags icon"></i>标签</a>
            <a class="m-item item m-mobile-hide" href="javascript:;"><i class="clone icon"></i>归档</a>
            <a class="m-item item m-mobile-hide" href="javascript:;"><i class="info icon"></i>关于我</a>
            <div class="right m-item item m-mobile-hide">
                <div class="ui icon inverted transparent input">
                    <input placeholder="Search..." type="text">
                    <i class="search link icon"></i>
                </div>
            </div>
        </div>
    </div>
    <a class="ui menu toggle icon black button m-right-top m-mobile-show" href="javascript:;">
        <i class="sidebar icon"></i>
    </a>
</nav>

<!--中间内容-->
<div class="m-container m-body-container m-padded-tb">
    <div class="ui container">
        <!-- container有响应式效果，根据屏幕不同的尺寸达到适应的效果-->
        <div class="ui stackable grid">
            <!--左边待办列表-->
            <div id="todo_container" class="eleven wide column">
                <!--todo_container加载，fragment获取返回的值-->
                <div name="todo_container" th:fragment="todoList">
                    <!--一定要先jquery，再Semantic！！！！！
    放这儿是因为，这部分的页面要动态加载，但是，动态加载过后，在js里绑定的事件就用不了了，索性直接塞里面
-->
                    <script src="../static/js/jquery.js" th:src="@{/js/jquery.js}"></script>
                    <script src="../static/js/semantic.js" th:src="@{/js/semantic.js}"></script>
                    <script src="../static/js/jquery.scrollTo.min.js" th:src="@{/js/jquery.scrollTo.min.js}"></script>
                    <script th:inline="javascript">
                        //ajax发送请求
                        function postData() {
                            prepost();
                            //第一个参数是请求的地址，第二个参数（代码块）填写相关的参数，这些参数会提交
                            $('#todo_container').load("/todos/"+$("[name='taskDate']").val(), {
                                'id': $("[name='id']").val(),
                                'flag': $("[name='flag']").val(),
                                'title': $("[name='title']").val(),
                                'content': $("[name='content']").val(),
                                'type.id': $("[name='type.id']").val(),
                                'tagIds': $("[name='tagIds']").val(),
                                'taskDate': $("[name='taskDate']").val(),
                                'repeat': $("[name='repeat']").prop("checked"),
                                'interval': $("[name='m_interval']").val(),
                                'totalTimes': $("[name='total_times']").val()
                            }, function (responseTxt, statusTxt, xhr) {
                                //callback 回调方法
                                //判断是否成功，刷新，滚动到comment头
                                responseFromTodos(responseTxt,statusTxt,xhr,getdate());
                                $(window).scrollTo($('#todo_container'), 500);
                                clearContent();
                            });
                        }

                        //表单验证
                        $('#todo-form').form({
                            fields: {
                                title: {
                                    identifier: 'title',
                                    rules: [{
                                        type: 'empty',
                                        prompt: '标题：请输入待办标题'
                                    }]
                                },
                                content: {
                                    identifier: 'content',
                                    rules: [{
                                        type: 'empty',
                                        prompt: '内容：请输入待办内容'
                                    }]
                                },
                                typeId: {
                                    identifier: 'type.id',
                                    rules: [{
                                        type: 'empty',
                                        prompt: '分类：请选择分类'
                                    }]
                                },
                                edit_m_interval: {
                                    identifier: 'edit_m_interval',
                                    rules: [{
                                    }]
                                },
                                edit_total_times: {
                                    identifier: 'edit_total_times',
                                    rules: [{
                                    }]
                                }
                            }
                        });
                        //根据日期查待办选择的日期
                        function setQuery_date(date){
                            $('#query_date').val(/*[[${queryDate}]]*/"").change(function () {
                                console.log($('#query_date').val());
                            });
                        }
                        //当选中的为复习时
                        $("#review_item").on("click", function () {
                            $('#repeat').prop("checked", false).prop("disabled", true);
                            repeatChange();
                        });
                        //当选中的为待办时
                        $("#todo_item").on("click", function () {
                            $('#repeat').prop("disabled", false);
                            repeatChange();
                        });
                        //点击新建待办按钮之后的事件
                        $('#create_todo_btn').on("click", function () {
                            if(/*[[${#lists.isEmpty(types)}]]*/false) {
                                alert("请先前往个人中心添加分类!");
                            }else{
                                $('.ui.add.dropdown').dropdown();
                                var status = document.getElementById("create_todo_form").style.display;
                                console.log($("#todo_or_review_input").val());
                                if (status == "none") {
                                    document.getElementById("create_todo_btn").innerText = "放弃新增";
                                    document.getElementById("create_todo_form").style.display = "";
                                    document.getElementById("edit_todo_form").style.display = "none";
                                    $('#taskDate').val(getdate());
                                } else {
                                    document.getElementById("create_todo_btn").innerText = "新增待办";
                                    document.getElementById("create_todo_form").style.display = "none";
                                }
                            }
                        });
                        //多选框“重复”被选中后 TODO 改成switch样式会好看点
                        $('#repeat').change(function () {
                            repeatChange();
                        });

                        //勾选重复之后的操作
                        function repeatChange() {
                            if ($('#repeat').prop('checked')) {
                                document.getElementById("repeat_input").style.display = "";
                                document.getElementById('total_times_div').classList.add("required");
                                document.getElementById('m_interval_div').classList.add("required");
                                $('#todo-form').form('add rule',
                                    'm_interval', {
                                        rules: [{
                                            type: 'integer[1..65535]',
                                            prompt: '间隔：只能输入1~65535间的数字哦'
                                        }]
                                    }).form('add rule',
                                    'total_times', {
                                        rules: [{
                                            type: 'integer[-1..65535]',
                                            prompt: '重复次数：只能输入[-1,65535]间的数字哦'
                                        }]
                                    });
                            } else {
                                document.getElementById("repeat_input").style.display = "none";
                                document.getElementById('total_times_div').classList.remove("required");
                                document.getElementById('m_interval_div').classList.remove("required");
                                $('#todo-form').form('remove fields', ['m_interval', 'total_times']);
                            }
                        }

                        //点击提交添加后，进行表单校验后，传送数据
                        $('#add-btn').click(function () {
                            $('#todo-form').form('validate form');
                            var boo = $('#todo-form').form('is valid');
                            // var boo = $('.ui.form').form('validate field(todo_container)');
                            if (boo) {
                                console.log("校验成功");
                                postData();
                            } else {
                                console.log("校验失败");
                            }
                        });

                        //表单恢复默认值
                        function clearContent() {
                            $("[name='id']").val("");
                            $("[name='flag']").val("待办");
                            $("[name='title']").val("");
                            $("[name='content']").val("");
                            $("[name='type.id']").val("");
                            $("[name='tagIds']").val("");
                            $("[name='repeat']").prop("checked",false);
                            $("[name='m_interval']").val(1);
                            $("[name='total_times']").val(5);
                        }

                        function isFinish(obj) {
                            // 判断，是待办，则显示model，提示是否完成
                            // 是复习，则显示popup，3个按钮打分，获取id、打分内容、进行更新$(obj).data('id')
                            if($(obj).data('flag') == "待办"){
                                $('.ui.modal')
                                    .modal({
                                        onDeny    : function(){
                                            console.log("用户点击取消");
                                        },
                                        onApprove : function() {
                                            // window.alert('Approved!');
                                            // 传请求，根据id更新待办，return “_todo:: todoList"
                                            console.log($(obj).data("id"));
                                            postFinish($(obj).data("id"));
                                        }
                                    })
                                    .modal('show')
                                ;
                            }else if($(obj).data('flag') == "复习"){
                                console.log("复习");
                            }else{
                                window.alert('既不是待办也不是复习！！！');
                            }
                        }
                        function postFinish(id){
                            prepost();
                            console.log("id"+id);
                            window.open("/todos/"+id+"/finish", "_self");
                        }

                        function postRating(id, rate) {
                            prepost();
                            console.log("id="+id);
                            console.log("rate="+rate);
                            window.open("/todos/"+id+"/finish/"+rate, "_self");
                        }
                    </script>
                    <!--顶部日期选择-->
                    <div class="ui segment">
                        <div class="ui middle aligned grid padded stackable">
                            <div class="three wide column m-padded-mini">
                                <a class="ui fluid teal basic button" href="javascript:queryByDate(-1);">前一日</a>
                            </div>
                            <div class="seven wide left aligned column m-padded-tb-mini m-padded-mini">
                                <div class="ui basic labeled fluid input">
                                    <div class="ui basic center aligned label">查询日期</div>
                                    <input class="ui mini date" id="query_date" type="date">
                                </div>
                            </div>
                            <div class="three wide column m-padded-tb-mini m-padded-mini">
                                <button type="button" class="ui basic fluid blue button" id="query_btn" onclick="queryByDate(0)">查询</button>
                            </div>
                            <div class="three wide column m-padded-mini">
                                <a class="ui fluid teal basic button" href="javascript:queryByDate(1);">后一日</a>
                            </div>
                        </div>
                    </div>


                    <!--确认对话框-->
                    <div class="ui modal">
                        <div class="ui header">
                            本条待办已经完成？
                        </div>
                        <div class="content">
                            <p>点击 ’确定‘ 后，此待办将进入已完成列表，<strong class="red">不可撤销！</strong></p>
                        </div>
                        <div class="actions">
                            <div class="ui red cancel inverted button">
                                <i class="remove icon"></i>
                                取消
                            </div>
                            <div class="ui green ok inverted button">
                                <i class="checkmark icon"></i>
                                确定
                            </div>
                        </div>
                    </div>
                    <div id="todo_content">
                        <!--今日未完成标题-->
                        <div class="ui red top attached segment">
                            <div class="ui middle aligned two column grid">
                                <div class="column">
                                    <h3 class="ui orange header">今日未完成</h3>
                                </div>
                                <div class="right aligned column">
                                    <!--h是block元素，所以会直接换行,这里自定义m-inline-block-->
                                    共 <h2 class="ui orange header m-inline-block m-text-thin"
                                          th:text="${todos}!=null ? ${todos.size}:0">
                                    14 </h2> 个
                                </div>
                            </div>
                        </div>
                        <!--今日未完成内容-->
                        <div class="ui attached segment">
                            <div class="ui inverted dimmer">
                                <div class="ui loader"></div>
                            </div>

                            <div class="ui raised attached segment" th:if="${todos}==null or ${todos.size}==0">
                                <p>今天的任务全部完成啦~</p>
                            </div>
                            <div class="ui raised attached segment" th:each="todo : ${todos}">
                                <input type="hidden" name="eachTodoId" th:value="${todo.id}">
                                <div class="ui ribbon label" th:text="(${todo.isRemain}?'遗留的':'')+${todo.flag}"
                                     th:classappend="(${todo.isRemain}?(${todo.flag}=='复习'?'red':'pink'):(${todo.flag}=='复习'?'olive':'teal'))">遗留的复习</div>
                                <strong th:text="${todo.title}+'&nbsp;&nbsp;&nbsp;&nbsp;'">待复习的主题</strong><span th:text="${todo.totalTimes>1}?|第${todo.totalTimes-todo.remainTimes+1}次|">第x次</span>
                                <p style="margin-bottom: 0 !important;" th:text="|目标日期:${todo.taskDate}|">日期：2021年4月16日</p>
                                <p style="margin-bottom: 5px !important;" th:text="|内容:${todo.content}|">待复习的细节，第一点，今天背了xxxxx。第二点，今天写了xxxxx。第三点，今天xxxxxx了，等等。
                                    待复习的细节，第一点，今天背了xxxxx。第二点，今天写了xxxxx。第三点，今天xxxxxx了，等等。</p>
                                <div class="ui mobile stackable grid">
                                    <div class="row">
                                        <div class="eight wide column">
                                            <label class="ui m-padded-tb-small basic blue label" th:text="${todo.type.name}">类型</label>
                                            <label class="ui m-padded-tb-small basic teal left pointing label"
                                                   th:each="tag : ${todo.tags}"
                                                   th:text="${tag.name}">标签1</label>
                                            <!--/*-->
                                            <label class="ui m-padded-tb-small left pointing label">标签2</label>
                                            <!--*/-->
                                        </div>
                                        <div class="right aligned eight wide column">
                                            <div class="ui buttons">
                                                <a href="javascript:;" class="ui basic blue m-padded-tb-small button"
                                                   data-id="1" data-flag="复习" data-title="标题" data-content="内容" data-createtime="2021-04-10 xx:xx:xx"
                                                   data-updatetime="2021-04-10 xx:xx:xx" data-finisheddate="2021-04-10" data-taskdate="2021-04-10"
                                                   data-interval="1" data-totaltimes="5" data-remaintimes="5" data-easinessfactor="2.0" data-tagids="1,2,3"
                                                   data-repeat="true" data-typeid="10"
                                                   th:attr="data-id=${todo.id}, data-flag=${todo.flag}, data-title=${todo.title}, data-content=${todo.content},
                                                    data-createtime=${todo.createTime}, data-updatetime=${todo.updateTime}, data-finisheddate=${todo.finishedDate},
                                                    data-taskdate=${todo.taskDate}, data-interval=${todo.interval}, data-totaltimes=${todo.totalTimes},
                                                    data-remaintimes=${todo.remainTimes}, data-easinessfactor=${todo.easinessFactor}, data-tagids=${todo.tagIds},
                                                    data-repeat=${todo.repeat}, data-typeid=${todo.type.id}"
                                                   onclick="editTodo(this)">编辑</a>

                                                <button href="javascript:;" th:id="finbtn+${todo.id}" onclick="isFinish(this)"
                                                        th:attr="data-id=${todo.id}, data-flag=${todo.flag}"
                                                        class="ui finbtn basic positive m-padded-tb-small button"
                                                        th:attrappend="data-html=${todo.flag}==复习 ? |<div class='header'>评价：</div>
                                                                    <div class='content'>
                                                                        <div class='ui buttons'>
                                                                            <a href='javascript:console.log(${todo.id}_2);' onclick='postRating(${todo.id},2)' class='ui m-padded-tiny basic red button'>不熟</a>
                                                                            <a href='javascript:console.log(${todo.id}_4);' onclick='postRating(${todo.id},4)' class='ui m-padded-tiny basic blue button'>一般</a>
                                                                            <a href='javascript:console.log(${todo.id}_6);' onclick='postRating(${todo.id},6)' class='ui m-padded-tiny basic green button'>很熟</a>
                                                                        </div>
                                                                    </div>|"
                                                        >完成</button>
                                                <a href="javascript:;" class="ui basic negative m-padded-tb-small button" th:href="|javascript:deleteTodo(${todo.id},$('#query_date').val());|">删除</a>
                                                <script>
                                                    // 保证复习的评价框的弹出
                                                    $('.ui[data-html]')
                                                        .popup({
                                                            on: 'click'
                                                        });

                                                </script>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!--/*-->
                            <div class="ui raised attached segment">
                                <div class="ui red ribbon label">遗留的复习</div>
                                <strong>待复习的主题</strong>
                                <p>待复习的细节，第一点，今天背了xxxxx。第二点，今天写了xxxxx。第三点，今天xxxxxx了，等等。
                                    待复习的细节，第一点，今天背了xxxxx。第二点，今天写了xxxxx。第三点，今天xxxxxx了，等等。</p>
                                <div class="ui mobile stackable grid">
                                    <div class="row">
                                        <div class="eight wide column">
                                            <label href="javascript:;" class="ui m-padded-tb-small label">类型</label>
                                            <label href="javascript:;" class="ui m-padded-tb-small left pointing label">标签1</label>
                                            <label href="javascript:;" class="ui m-padded-tb-small left pointing label">标签2</label>
                                        </div>
                                        <div class="right aligned eight wide column">
                                            <div class="ui buttons">
                                                <button href="javascript:;" class="ui basic blue m-padded-tb-small button">编辑</button>
                                                <button href="javascript:;" class="ui basic positive m-padded-tb-small button">完成</button>
                                                <button href="javascript:;" class="ui basic negative m-padded-tb-small button">删除
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="ui raised attached segment">
                                <div class="ui pink ribbon label">遗留的待办</div>
                                <strong>待办的主题</strong>
                                <p>待办的细节，第一点，今天背了xxxxx。第二点，今天写了xxxxx。第三点，今天xxxxxx了，等等。
                                    待办的细节，第一点，今天背了xxxxx。第二点，今天写了xxxxx。第三点，今天xxxxxx了，等等。</p>
                                <div class="ui mobile stackable grid">
                                    <div class="row">
                                        <div class="eight wide column">
                                            <label href="javascript:;" class="ui m-padded-tb-small label">类型</label>
                                            <label href="javascript:;" class="ui m-padded-tb-small left pointing label">标签1</label>
                                            <label href="javascript:;" class="ui m-padded-tb-small left pointing label">标签2</label>
                                        </div>
                                        <div class="right aligned eight wide column">
                                            <div class="ui buttons">
                                                <button href="javascript:;" class="ui basic blue m-padded-tb-small button">编辑</button>
                                                <button href="javascript:;" class="ui basic positive m-padded-tb-small button">完成
                                                </button>
                                                <button href="javascript:;" class="ui basic negative m-padded-tb-small button">删除
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="ui raised attached segment">
                                <div class="ui olive ribbon label">复习</div>
                                <strong>待复习的主题</strong>
                                <p>待复习的细节，第一点，今天背了xxxxx。第二点，今天写了xxxxx。第三点，今天xxxxxx了，等等。
                                    待复习的细节，第一点，今天背了xxxxx。第二点，今天写了xxxxx。第三点，今天xxxxxx了，等等。</p>
                                <div class="ui mobile stackable grid">
                                    <div class="row">
                                        <div class="eight wide column">
                                            <label href="javascript:;" class="ui m-padded-tb-small label">类型</label>
                                            <label href="javascript:;" class="ui m-padded-tb-small left pointing label">标签1</label>
                                            <label href="javascript:;" class="ui m-padded-tb-small left pointing label">标签2</label>
                                        </div>
                                        <div class="right aligned eight wide column">
                                            <div class="ui buttons">
                                                <button href="javascript:;" class="ui basic blue m-padded-tb-small button">编辑</button>
                                                <button href="javascript:;" class="ui basic positive m-padded-tb-small button">完成
                                                </button>
                                                <button href="javascript:;" class="ui basic negative m-padded-tb-small button">删除
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="ui raised attached segment">
                                <div class="ui teal ribbon label">待办</div>
                                <strong>待办的主题</strong>
                                <p>待办的细节，第一点，今天背了xxxxx。第二点，今天写了xxxxx。第三点，今天xxxxxx了，等等。
                                    待办的细节，第一点，今天背了xxxxx。第二点，今天写了xxxxx。第三点，今天xxxxxx了，等等。</p>
                                <div class="ui mobile stackable grid">
                                    <div class="row">
                                        <div class="eight wide column">
                                            <label href="javascript:;" class="ui m-padded-tb-small label">类型</label>
                                            <label href="javascript:;" class="ui m-padded-tb-small left pointing label">标签1</label>
                                            <label href="javascript:;" class="ui m-padded-tb-small left pointing label">标签2</label>
                                        </div>
                                        <div class="right aligned eight wide column">
                                            <div class="ui buttons">
                                                <button href="javascript:;" class="ui basic blue m-padded-tb-small button">编辑</button>
                                                <button href="javascript:;" class="ui basic positive m-padded-tb-small button">完成
                                                </button>
                                                <button href="javascript:;" class="ui basic negative m-padded-tb-small button">删除
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!--*/-->
                        </div>
                        <!--新增待办按钮-->
                        <div class="ui attached segment">
                            <button id="create_todo_btn" class="ui basic blue fluid button">新增日程</button>
                        </div>
                        <!--新增的表单-->
                        <div id="create_todo_form" class="ui attached segment" style="display: none;">
                            <div class="ui container">
                                <div id="todo-form" class="ui form">
                                    <input type="hidden" name="id">
                                    <input type="hidden" name="createTime">
                                    <!--            <input type="hidden" name="updateTime" th:value="*{updateTime}">-->
                                    <div class="required field">
                                        <div class="ui left labeled input">
                                            <div class="ui add selection compact teal basic dropdown label">
                                                <input id="todo_or_review_input" type="hidden" name="flag" value="待办">
                                                <i class="dropdown icon"></i>
                                                <div class="text">待办</div>
                                                <div class="menu">
                                                    <label id="review_item" class="item" data-value="复习">复习</label>
                                                    <label id="todo_item" class="item" data-value="待办">待办</label>
                                                </div>
                                            </div>
                                            <input type="text" name="title" placeholder="标题">
                                        </div>
                                    </div>
                                    <div class="required field">
                                        <div>
                                            <textarea name="content" placeholder="请输入待办内容"></textarea>
                                        </div>
                                    </div>
                                    <div class="required field">
                                        <div class="ui left labeled input">
                                            <label class="ui compact teal basic label">分类</label>
                                            <div class="ui add fluid selection dropdown">
                                                <input type="hidden" name="type.id">
                                                <i class="dropdown icon"></i>
                                                <div class="default text">分类</div>
                                                <div class="menu">
                                                    <div th:each="type : ${types}" class="item" data-value="1"
                                                         th:data-value="${type.id}" th:text="${type.name}">错误日志
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="field">
                                        <div class="ui left labeled input">
                                            <label class="ui compact teal basic label">标签</label>
                                            <div class="ui add fluid selection multiple search dropdown">
                                                <input type="hidden" name="tagIds">
                                                <i class="dropdown icon"></i>
                                                <div class="default text">标签</div>
                                                <div class="menu">
                                                    <div th:each="tag : ${tags}" class="item" data-value="1"
                                                         th:data-value="${tag.id}" th:text="${tag.name}">Java
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="two fields">
                                        <div class="ui basic teal labeled fluid input required field">
                                            <div class="ui basic teal center aligned label">目标日期</div>
                                            <input id="taskDate" type="date" name="taskDate" value=""/>
                                        </div>
                                        <div id="repeat_div" class="center aligned field">
                                            <div class="ui right aligned toggle checkbox">
                                                <input id="repeat" type="checkbox" name="repeat" class="hidden">
                                                <label for="repeat">重复</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="repeat_input" class="two fields" style="display: none;">
                                        <div id="m_interval_div" class="field">
                                            <div class="ui left labeled input">
                                                <label class="ui teal basic label">间隔天数</label>
                                                <input id="m_interval" type="number" name="m_interval" value="1"/>
                                            </div>
                                            <p>间隔天数应为正整数，当其为1时，代表每天都有此待办。</p>
                                        </div>
                                        <div id="total_times_div" class="field">
                                            <div class="ui left labeled input">
                                                <label class="ui teal basic label">重复次数</label>
                                                <input id="total_times" type="number" name="total_times" value="5"/>
                                            </div>
                                            <p>重复次数为-1时，此待办永不停止，为0则代表此项已完成。</p>
                                        </div>
                                    </div>
                                    <div id="add_error_msg" class="ui error message"></div>
                                    <div class="ui right aligned container">
                                        <!--若不指定type=button，则默认为submit-->
                                        <button type="button" id="add-btn" class="ui basic primary button">添加</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--修改的表单-->
                        <script  th:inline="javascript">
                            //表单验证
                            $('#edit_todo_form').form({
                                fields: {
                                    edit_title: {
                                        identifier: 'edit_title',
                                        rules: [{
                                            type: 'empty',
                                            prompt: '标题：请输入待办标题'
                                        }]
                                    },
                                    edit_content: {
                                        identifier: 'edit_content',
                                        rules: [{
                                            type: 'empty',
                                            prompt: '内容：请输入待办内容'
                                        }]
                                    },
                                    edit_typeId: {
                                        identifier: 'edit_type.id',
                                        rules: [{
                                            type: 'empty',
                                            prompt: '分类：请选择分类'
                                        }]
                                    },
                                    edit_m_interval: {
                                        identifier: 'edit_m_interval',
                                        rules: [{
                                        }]
                                    },
                                    edit_total_times: {
                                        identifier: 'edit_total_times',
                                        rules: [{
                                        }]
                                    }
                                }
                            });
                            //多选框“重复”被选中后 TODO 改成switch样式会好看点
                            $('#edit_repeat').change(function () {
                                edit_repeatChange();
                            });
                            //勾选重复之后的操作
                            function edit_repeatChange() {
                                if ($('#edit_repeat').prop('checked')) {
                                    document.getElementById("edit_repeat_input").style.display = "";
                                    document.getElementById('edit_total_times_div').classList.add("required");
                                    document.getElementById('edit_m_interval_div').classList.add("required");
                                    $('#edit_todo_form').form('add rule',
                                        'edit_m_interval', {
                                            rules: [{
                                                type: 'integer[1..65535]',
                                                prompt: '间隔：只能输入1~65535间的数字哦'
                                            }]
                                        }).form('add rule',
                                        'edit_total_times', {
                                            rules: [{
                                                type: 'integer[-1..65535]',
                                                prompt: '重复次数：只能输入[-1,65535]间的数字哦'
                                            }]
                                        });
                                } else {
                                    document.getElementById("edit_repeat_input").style.display = "none";
                                    document.getElementById('edit_total_times_div').classList.remove("required");
                                    document.getElementById('edit_m_interval_div').classList.remove("required");
                                    $('#edit_todo_form').form('remove fields', ['edit_m_interval', 'edit_total_times']);
                                }
                            }


                            //点击提交添加后，进行表单校验后，传送数据
                            $('#edit-submit-btn').click(function () {
                                $('#edit_todo_form').form('validate form');
                                var boo = $('#edit_todo_form').form('is valid');
                                if (boo) {
                                    document.getElementById("edit_error_msg").style.display = "none";
                                    console.log("校验成功");
                                    postEditData();
                                } else {
                                    document.getElementById("edit_error_msg").style.display = "block";
                                    console.log("校验失败");
                                }
                            });

                            //ajax发送请求
                            function postEditData() {
                                prepost();
                                //第一个参数是请求的地址，第二个参数（代码块）填写相关的参数，这些参数会提交
                                $('#todo_container').load("/todos/"+$("[name='edit_taskDate']").val(), {
                                    'id': $("[name='edit_id']").val(),
                                    'flag': $("[name='edit_flag']").val(),
                                    'title': $("[name='edit_title']").val(),
                                    'content': $("[name='edit_content']").val(),
                                    'type.id': $("[name='edit_type.id']").val(),
                                    'tagIds': $("[name='edit_tagIds']").val(),
                                    'taskDate': $("[name='edit_taskDate']").val(),
                                    'repeat': $("[name='edit_repeat']").prop("checked"),
                                    'interval': $("[name='edit_m_interval']").val(),
                                    'totalTimes': $("[name='edit_total_times']").val(),
                                    'createTime': $("[name='edit_createtime']").val()
                                }, function (responseTxt, statusTxt, xhr) {
                                    //callback 回调方法
                                    //判断是否成功，刷新，滚动到comment头
                                    responseFromTodos(responseTxt,statusTxt,xhr,getdate());
                                    $(window).scrollTo($('#todo_container'), 500);
                                    clearEditContent();
                                });
                            }
                            //表单恢复默认值
                            function clearEditContent() {
                                $("[name='edit_id']").val("");
                                $("[name='edit_flag']").val("待办");
                                $("[name='edit_title']").val("");
                                $("[name='edit_content']").val("");
                                $("[name='edit_type.id']").val("");
                                $("[name='edit_tagIds']").val("");
                                $("[name='edit_repeat']").prop("checked",false);
                                edit_repeatChange();
                                $("[name='edit_m_interval']").val(1);
                                $("[name='edit_total_times']").val(5);
                            }
                            function editTodo(obj) {
                                document.getElementById("create_todo_btn").innerText = "新增待办";
                                document.getElementById("create_todo_form").style.display = "none";
                                document.getElementById("edit_todo_form").style.display = "";
                                $("[name='edit_id']").val($(obj).data('id'));
                                $("[name='edit_flag']").val($(obj).data('flag'));
                                $("#edit_todo_or_review_text").text($(obj).data('flag')).val($(obj).data('flag'));
                                $("[name='edit_title']").val($(obj).data('title'));
                                $("[name='edit_content']").val($(obj).data('content')).focus();
                                $('.ui.edit.dropdown').dropdown('clear');
                                $("[name='edit_type.id']").val($(obj).data('typeid'));
                                $("[name='edit_tagIds']").val($(obj).data('tagids'));
                                $('.ui.dropdown').dropdown();
                                $('#edit_tags_dropdown').dropdown();
                                if($(obj).data('flag')=="复习"){
                                    $("[name='edit_repeat']").prop("checked",false).prop("disabled",true);
                                }else{
                                    $("[name='edit_repeat']").prop("checked",$(obj).data('repeat')).prop("disabled",false);
                                }
                                edit_repeatChange();
                                $("[name='edit_m_interval']").val(Math.round($(obj).data('interval')));
                                $("[name='edit_total_times']").val($(obj).data('totaltimes'));
                                $("[name='edit_taskDate']").val($(obj).data('taskdate'));
                                //额外赋值操作
                                // $("[name='edit_type.name']").text($(obj).data('typename')).removeClass("default");

                                //隐含域
                                $("[name='edit_createtime']").val($(obj).data('createtime'));
                                $("[name='edit_updatetime']").val($(obj).data('updatetime'));
                                $("[name='edit_finisheddate']").val($(obj).data('finisheddate'));
                                $("[name='edit_easinessfactor']").val($(obj).data('easinessfactor'));
                                $("[name='edit_remainTimes']").val($(obj).data('remaintimes'));
                                $(window).scrollTo($('#edit_todo_form'), 500);
                            }
                            $('#edit-drop-btn').click(function () {
                                clearEditContent();
                                document.getElementById("edit_todo_form").style.display = "none";
                            });
                        </script>
                        <div id="edit_todo_form" class="ui attached segment" style="display: none;">
                            <div class="ui container">
                                <div id="edit-form" class="ui form">
                                    <input type="hidden" name="edit_id" placeholder="id">
                                    <input type="hidden" name="edit_createtime" placeholder="createtime">
                                    <input type="hidden" name="edit_updatetime" placeholder="updatetime">
                                    <input type="hidden" name="edit_finisheddate"  placeholder="finisheddate">
                                    <input type="hidden" name="edit_easinessfactor"  placeholder="easinessfactor">
                                    <input type="hidden" name="edit_remainTimes"  placeholder="remainTimes">
                                    <div class="required field">
                                        <div class="ui left labeled input">
                                            <!--flag不可更改-->
                                            <div class="ui compact grey basic label">
                                                <input id="edit_todo_or_review_input" type="hidden" name="edit_flag" value="待办">
                                                <div id="edit_todo_or_review_text" class="text">待办</div>
                                            </div>
                                            <input type="text" name="edit_title" placeholder="标题">
                                        </div>
                                    </div>
                                    <div class="required field">
                                        <div>
                                            <textarea name="edit_content" placeholder="请输入待办内容"></textarea>
                                        </div>
                                    </div>
                                    <div class="required field">
                                        <div class="ui left labeled input">
                                            <label class="ui compact teal basic label">分类</label>
                                            <div class="ui edit fluid selection dropdown">
                                                <input type="hidden" name="edit_type.id">
                                                <i class="dropdown icon"></i>
                                                <div name="edit_type.name" class="default text">分类</div>
                                                <div class="menu">
                                                    <div th:each="type : ${types}" class="item" data-value="1"
                                                         th:data-value="${type.id}" th:text="${type.name}">错误日志
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="field">
                                        <div class="ui left labeled input">
                                            <label class="ui compact teal basic label">标签</label>
                                            <div id="edit_tags_dropdown" class="ui edit fluid selection multiple search dropdown">
                                                <input type="hidden" name="edit_tagIds">
                                                <i class="dropdown icon"></i>
                                                <div class="default text">标签</div>
                                                <div class="menu">
                                                    <div th:each="tag : ${tags}" class="item" data-value="1"
                                                         th:data-value="${tag.id}" th:text="${tag.name}">Java
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="two fields">
                                        <div class="ui basic teal labeled fluid input required field">
                                            <div class="ui basic teal center aligned label">目标日期</div>
                                            <input id="edit_taskDate" type="date" name="edit_taskDate" value=""/>
                                        </div>
                                        <div id="edit_repeat_div" class="center aligned field">
                                            <div class="ui toggle checkbox">
                                                <input id="edit_repeat" type="checkbox" name="edit_repeat" class="hidden">
                                                <label for="edit_repeat">重复</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="edit_repeat_input" class="two fields" style="display: none;">
                                        <div id="edit_m_interval_div" class="field">
                                            <div class="ui left labeled input">
                                                <label class="ui teal basic label">间隔天数</label>
                                                <input id="edit_m_interval" type="number" name="edit_m_interval" value="1"/>
                                            </div>
                                            <p>间隔天数应为正整数，当其为1时，代表每天都有此待办。</p>
                                        </div>
                                        <div id="edit_total_times_div" class="field">
                                            <div class="ui left labeled input">
                                                <label class="ui teal basic label">重复次数</label>
                                                <input id="edit_total_times" type="number" name="edit_total_times" value="5"/>
                                            </div>
                                            <p>重复次数为-1时，此待办永不停止，为0则代表此项已完成。</p>
                                        </div>
                                    </div>
                                    <div id="edit_error_msg" class="ui error message"></div>

                                    <div class="ui right aligned container">
                                        <!--若不指定type=button，则默认为submit-->
                                        <button type="button" id="edit-drop-btn" class="ui basic secondary button">放弃修改</button>
                                        <button type="button" id="edit-submit-btn" class="ui basic primary button">提交修改</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!--为了统计方便，必须将待办分为两个list，已完成与未完成，后台查询list，进行分类即可-->
                        <!--今日已完成的标题-->
                        <div class="ui green top attached m-margin-top-large segment">
                            <div class="ui middle aligned two column grid">
                                <div class="column">
                                    <h3 class="ui green header">今日已完成</h3>
                                </div>
                                <div class="right aligned column">
                                    <!--h是block元素，所以会直接换行,这里自定义m-inline-block-->
                                    共 <h2 class="ui green header m-inline-block m-text-thin"
                                          th:text="${finishedTodos}!=null ? ${finishedTodos.size}:0">
                                    14 </h2> 个
                                </div>
                            </div>
                        </div>
                        <!--已完成的内容-->
                        <div class="ui attached segment">
                            <div class="ui inverted dimmer">
                                <div class="ui loader"></div>
                            </div>
                            <div class="ui raised attached segment" th:if="${finishedTodos}==null or ${finishedTodos.size}==0">
                                <p>今天还没有已完成的任务哦~</p>
                            </div>
                            <div class="ui raised attached segment" th:each="todo : ${finishedTodos}">
                                <input type="hidden" name="eachTodoId" th:value="${todo.id}">
                                <div class="ui ribbon green label" th:text="(${todo.isRemain}?'超时完成的':'')+${todo.flag}">遗留的复习</div>
                                <strong th:text="${todo.title}+'&nbsp;&nbsp;&nbsp;&nbsp;'">待复习的主题</strong><span th:text="${todo.totalTimes>1}?|第${todo.totalTimes-todo.remainTimes}次|">第x次</span>
                                <p style="margin-bottom: 0 !important;" th:text="|目标日期:${todo.taskDate}|">日期：2021年4月16日</p>
                                <p style="margin-bottom: 5px !important;" th:text="|内容:${todo.content}|">待复习的细节，第一点，今天背了xxxxx。第二点，今天写了xxxxx。第三点，今天xxxxxx了，等等。
                                    待复习的细节，第一点，今天背了xxxxx。第二点，今天写了xxxxx。第三点，今天xxxxxx了，等等。</p>
                                <div class="ui mobile stackable grid">
                                    <div class="row">
                                        <div class="eight wide column">
                                            <label class="ui m-padded-tb-small basic blue label" th:text="${todo.type.name}">类型</label>
                                            <label class="ui m-padded-tb-small basic teal left pointing label"
                                                   th:each="tag : ${todo.tags}"
                                                   th:text="${tag.name}">标签1</label>
                                            <!--/*-->
                                            <label class="ui m-padded-tb-small left pointing label">标签2</label>
                                            <!--*/-->
                                        </div>
                                        <div class="right aligned eight wide column">
                                            <div class="ui buttons">
                                                <button href="javascript:;" class="ui basic disabled blue m-padded-tb-small button">编辑</button>
                                                <!--TODO 这里可以改成撤销，但是先不改-->
                                                <button href="javascript:;" class="ui basic disabled m-padded-tb-small button">完成</button>
                                                <a href="javascript:;" class="ui basic negative m-padded-tb-small button" th:href="|javascript:deleteTodo(${todo.id},$('#query_date').val());|">删除</a>                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!--/*-->
                            <div class="ui raised attached segment">
                                <div class="ui green ribbon label">复习</div><!--复习or待办-->
                                <strong>待复习的主题</strong>
                                <p>待复习的细节，第一点，今天背了xxxxx。第二点，今天写了xxxxx。第三点，今天xxxxxx了，等等。
                                    待复习的细节，第一点，今天背了xxxxx。第二点，今天写了xxxxx。第三点，今天xxxxxx了，等等。</p>
                                <div class="ui mobile stackable grid">
                                    <div class="row">
                                        <div class="eight wide column">
                                            <label href="javascript:;" class="ui m-padded-tb-small label">类型</label>
                                            <label href="javascript:;" class="ui m-padded-tb-small left pointing label">标签1</label>
                                            <label href="javascript:;" class="ui m-padded-tb-small left pointing label">标签2</label>
                                        </div>
                                        <div class="right aligned eight wide column">
                                            <div class="ui buttons">
                                                <button href="javascript:;" class="ui basic blue m-padded-tb-small button">编辑</button>
                                                <button href="javascript:;" class="ui basic disabled m-padded-tb-small button">已完成
                                                </button>
                                                <button href="javascript:;" class="ui basic negative m-padded-tb-small button">删除
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="ui raised attached segment">
                                <div class="ui green ribbon label">复习</div>
                                <strong>待复习的主题</strong>
                                <p>待复习的细节，第一点，今天背了xxxxx。第二点，今天写了xxxxx。第三点，今天xxxxxx了，等等。
                                    待复习的细节，第一点，今天背了xxxxx。第二点，今天写了xxxxx。第三点，今天xxxxxx了，等等。</p>
                                <div class="ui mobile stackable grid">
                                    <div class="row">
                                        <div class="eight wide column">
                                            <label href="javascript:;" class="ui m-padded-tb-small label">类型</label>
                                            <label href="javascript:;" class="ui m-padded-tb-small left pointing label">标签1</label>
                                            <label href="javascript:;" class="ui m-padded-tb-small left pointing label">标签2</label>
                                        </div>
                                        <div class="right aligned eight wide column">
                                            <div class="ui buttons">
                                                <button href="javascript:;" class="ui basic blue m-padded-tb-small button">编辑</button>
                                                <button href="javascript:;"
                                                        class="ui basic disabled positive m-padded-tb-small button">
                                                    完成
                                                </button>
                                                <button href="javascript:;" class="ui basic negative m-padded-tb-small button">删除
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="ui raised attached segment">
                                <div class="ui green ribbon label">待办</div>
                                <strong>待办的主题</strong>
                                <p>待办的细节，第一点，今天背了xxxxx。第二点，今天写了xxxxx。第三点，今天xxxxxx了，等等。
                                    待办的细节，第一点，今天背了xxxxx。第二点，今天写了xxxxx。第三点，今天xxxxxx了，等等。</p>
                                <div class="ui mobile stackable grid">
                                    <div class="row">
                                        <div class="eight wide column">
                                            <label href="javascript:;" class="ui m-padded-tb-small label">类型</label>
                                            <label href="javascript:;" class="ui m-padded-tb-small left pointing label">标签1</label>
                                            <label href="javascript:;" class="ui m-padded-tb-small left pointing label">标签2</label>
                                        </div>
                                        <div class="right aligned eight wide column">
                                            <div class="ui buttons">
                                                <button href="javascript:;" class="ui basic blue m-padded-tb-small button">编辑</button>
                                                <button href="javascript:;"
                                                        class="ui basic disabled positive m-padded-tb-small button">
                                                    完成
                                                </button>
                                                <button href="javascript:;" class="ui basic negative m-padded-tb-small button">删除
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!--*/-->
                        </div>
                    </div>
                </div>
            </div>


            <!--右边的TOP-->
            <div class="five wide column">
                <!-- 目标 -->
                <div class="ui segments">
                    <div class="ui secondary segment">
                        <div class="ui two column grid">
                            <div class="column">
                                <i class="idea icon"></i>目标
                            </div>
                            <div class="right aligned column">
                                <a href="javascript:;" target="_blank" th:href="@{/types/-1}">more <i
                                        class=" icon angle double right"></i></a>
                            </div>
                        </div>
                    </div>
                    <div class="ui teal segment">
                        <!--未填充满，加fluid-->
                        <div class="ui fluid vertical menu">
<!--                            <a class="item" target="_blank" href="javascript:;" th:href="@{/types/{id}(id=${type.id})}"-->
<!--                               th:each="type : ${types}">-->
<!--                                <span th:text="${type.name}">好好学习</span>-->
<!--                            </a>-->
                            <a class="item" href="javascript:;">
                                Just for Fun
                            </a>
                            <a class="item" href="javascript:;">
                                要么孤独，要么庸俗
                            </a>
                            <a class="item" href="javascript:;">
                                加油啊，研究生三年好好冲一把，读个985博士！
                            </a>
                        </div>
                    </div>
                </div>
                <!--倒计时-->
                <div class="ui segments">
                    <div class="ui secondary segment">
                        <div class="ui two column grid">
                            <div class="column">
                                <i class="time icon"></i>倒计时
                            </div>
                            <div class="right aligned column">
                                <a href="javascript:;" target="_blank" th:href="@{/admin/countdowns}">more <i
                                        class=" icon angle double right"></i></a>
                            </div>
                        </div>
                    </div>
                    <div class="ui teal segment">
                        <!--未填充满，加fluid-->
                        <script language="JavaScript" th:inline="javascript">
                            var showtime = function (endtime, comp, countName) {
                                var nowtime = new Date();  //获取当前时间
                                var lefttime = endtime.getTime() - nowtime.getTime(),  //距离结束时间的毫秒数
                                    leftd = Math.floor(lefttime/(1000*60*60*24));
                                if(lefttime<0) {
                                    leftd = -leftd
                                    comp.innerHTML =
                                        '<span><h2 class="ui orange header m-inline-block m-text-thin">'+countName+'</h2>已过' +
                                        '<h2 class="ui orange header m-inline-block m-text-thin">'+ (leftd-1) +'</h2>' +
                                        '天，截止于</span>' +
                                        '<span>'+
                                        '<h3 class="ui blue header m-inline-block m-text-thin">' + endtime.format("yyyy-MM-dd hh:mm:ss") +'</h3></span>'
                                    return
                                }
                                var lefth = Math.floor(lefttime/(1000*60*60)%24),  //计算小时数
                                    leftm = Math.floor(lefttime/(1000*60)%60),  //计算分钟数
                                    lefts = Math.floor(lefttime/1000%60);  //计算秒数
                                comp.innerHTML =
                                    '<span>距离<h2 class="ui orange header m-inline-block m-text-thin">'+countName+'</h2>只剩</span><br>' +
                                    '<span>'+
                                        '<h2 class="ui orange header m-inline-block m-text-thin">' + leftd + '</h2> Days' +
                                        '<h2 class="ui orange header m-inline-block m-text-thin">' + lefth + '</h2> Hs' +
                                        '<h2 class="ui orange header m-inline-block m-text-thin">' + leftm + '</h2> mins' +
                                        '<h2 class="ui orange header m-inline-block m-text-thin">' + lefts + '</h2> s' +
                                    '</span>'
                            }
                            setInterval (function () {
                                /*<![CDATA[*/
                                /*[# th:each="countdown : ${countdowns}"]*/
                                showtime(new Date(/*[[${countdown.countTime}]]*/"2021-6-30 8:00"), document.getElementById(/*[[|countdown${countdown.id}|]]*/""), /*[[${countdown.name}]]*/"");
                                /*[/]*/
                                /*]]>*/
                            }, 1000);  //反复执行函数本身
                        </script>
                        <div class="ui fluid vertical menu">
                            <a class="item" href="/admin/countdowns" th:if="${countdowns}==null or ${countdowns.size}==0">
                                好像没有可以显示的倒计时呢~点我管理倒计时哦~
                            </a>
                            <a class="item" th:each="countdown : ${countdowns}" th:id="|countdown${countdown.id}|" th:href="@{/admin/countdowns/{id}/input(id=${countdown.id})}">
                                <span>距离<h2 class="ui orange header m-inline-block m-text-thin" th:text="${countdown.name}">毕业答辩</h2>只剩</span><br>
                                <span>
                                    <h2 class="ui orange header m-inline-block m-text-thin">--</h2> Days
                                    <h2 class="ui orange header m-inline-block m-text-thin">--</h2> Hs
                                    <h2 class="ui orange header m-inline-block m-text-thin">--</h2> mins
                                    <h2 class="ui orange header m-inline-block m-text-thin">--</h2> s
                                </span>
                            </a>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>
<br>
<br>
<!--底部footer 为了保证有一个原型，所以index未替换footer-->
<footer class="ui inverted vertical segment m-padded-tb-big">
    <div class="ui center aligned container">
        <p class="m-text-thin m-text-spaced m-opacity-tiny"
           th:text="|#{index.copyright}${#dates.year(#dates.createToday())}|+' 南京信息工程大学'">版权所有 ©2020- 南京信息工程大学</p>
    </div>
</footer>

<script>
    $('.ui.dimmer').addClass("active");
    $('#todo_container').load("/todos",
        function(responseTxt,statusTxt,xhr) {
            responseFromTodos(responseTxt,statusTxt,xhr,getdate());
        });
    //当设备width过小时，顶部菜单切换为折叠样式
    $('.menu.toggle').click(function () {
        $('.m-item').toggleClass('m-mobile-hide');
    });
    //查询todos的回调方法
    function responseFromTodos(responseTxt,statusTxt,xhr,date) {
        if (statusTxt == "success"){
            console.log("External content loaded successfully!"+date);
            setQuery_date(date);
        }
        if (statusTxt == "error"){
            console.log("Error: " + xhr.status + ": " + xhr.statusText+date);
            setQuery_date(getdate());
        }
    }
    //根据日期查询待办,接受日期偏移 -1 0 1，查昨天 今天 明天
    function queryByDate(offset){
        let date = new Date($('#query_date').val());
        date=date.setDate(date.getDate()+offset);
        date=new Date(date).format("yyyy-MM-dd");
        // $('#query_date').val(new Date($('#query_date').val()-1).format('yyyy-MM-dd'));queryByDate($('#query_date').val())
        console.log(date);
        prepost();
        $('#todo_container').load("/todos/"+date,
            function(responseTxt,statusTxt,xhr) {
                responseFromTodos(responseTxt,statusTxt,xhr,date);
        });
    }
    function deleteTodo(id,taskDate){
        prepost();
        console.log("id="+id+",taskDate="+taskDate);
        $('#todo_container').load("/todos/"+id+"/delete/"+taskDate,
            function(responseTxt,statusTxt,xhr) {
                responseFromTodos(responseTxt,statusTxt,xhr,taskDate);
            });
    }
    Date.prototype.format = function(fmt) {
        var o = {
            "M+" : this.getMonth()+1,                 //月份
            "d+" : this.getDate(),                    //日
            "h+" : this.getHours(),                   //小时
            "m+" : this.getMinutes(),                 //分
            "s+" : this.getSeconds(),                 //秒
            "q+" : Math.floor((this.getMonth()+3)/3), //季度
            "S"  : this.getMilliseconds()             //毫秒
        };
        if(/(y+)/.test(fmt)) {
            fmt=fmt.replace(RegExp.$1, (this.getFullYear()+"").substr(4 - RegExp.$1.length));
        }
        for(var k in o) {
            if(new RegExp("("+ k +")").test(fmt)){
                fmt = fmt.replace(RegExp.$1, (RegExp.$1.length==1) ? (o[k]) : (("00"+ o[k]).substr((""+ o[k]).length)));
            }
        }
        return fmt;
    }
    //获取当前日期
    function getdate() {
        var time = new Date();
        var day = ("0" + time.getDate()).slice(-2);
        var month = ("0" + (time.getMonth() + 1)).slice(-2);
        var today = time.getFullYear() + "-" + (month) + "-" + (day);
        return today;
    }
    //post前，加载圈的显示
    function prepost(){
        $('.ui.dimmer').addClass("active");
    }
    $('.ui.dropdown').dropdown();
</script>
</body>
</html>