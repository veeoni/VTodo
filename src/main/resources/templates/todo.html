<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>代办列表</title>
    <link rel="stylesheet prefetch" href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css">
    <link rel='stylesheet prefetch' href='https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/components/icon.min.css'>
    <link rel="stylesheet  prefetch" href="../static/css/me.css" th:href="@{/css/me.css}"/>
</head>
<body>

<!--导航-->
<nav th:replace="_fragments :: menu(6)" class="ui inverted attached segment m-padded-tb-mini m-shadow-small">
    <div class="ui container">
        <!--stackable 屏幕小时可堆叠-->
        <div class="ui inverted stackable secondary menu">
            <h2 class="ui teal header item">Blog</h2>
            <a class="active m-item item m-mobile-hide" href="javascript:;"><i class="home icon"></i>首页</a>
            <a class="m-item item m-mobile-hide" href="javascript:;"><i class="idea icon"></i>分类</a>
            <a class="m-item item m-mobile-hide" href="javascript:;"><i class="tags icon"></i>标签</a>
            <a class="m-item item m-mobile-hide" href="javascript:;"><i class="clone icon"></i>归档</a>
            <a class="m-item item m-mobile-hide" href="javascript:;"><i class="info icon"></i>关于我</a>
            <div class="right m-item item m-mobile-hide">
                <div class="ui icon inverted transparent input">
                    <input placeholder="Search..." type="text">
                    <i class="search link icon"></i>
                </div>
            </div>
        </div>
    </div>
    <a class="ui menu toggle icon black button m-right-top m-mobile-show" href="javascript:;">
        <i class="sidebar icon"></i>
    </a>
</nav>

<!--中间内容-->
<div class="m-container m-padded-tb-big">
    <div class="ui container">
        <!-- container有响应式效果，根据屏幕不同的尺寸达到适应的效果-->
        <div class="ui stackable grid">
            <!--左边待办列表-->
            <div id="todo_container" class="eleven wide column">
                <!--todo_container加载，fragment获取返回的值-->

                <div name="todo_container" th:fragment="todoList">
                    <!--一定要先jquery，再Semantic！！！！！
    放这儿是因为，这部分的页面要动态加载，但是，动态加载过后，在js里绑定的事件就用不了了，索性直接塞里面
-->
                    <script src="../static/js/jquery.js" th:src="@{/js/jquery.js}"></script>
                    <script src="../static/js/semantic.js" th:src="@{/js/semantic.js}"></script>
                    <script src="../static/js/jquery.scrollTo.min.js" th:src="@{/js/jquery.scrollTo.min.js}"></script>
                    <script th:inline="javascript">
                        //ajax发送请求
                        function postData() {
                            //第一个参数是请求的地址，第二个参数（代码块）填写相关的参数，这些参数会提交
                            $('#todo_container').load(/*[[@{/todos}]]*/+"", {
                                'id': $("[name='id']").val(),
                                'flag': $("[name='flag']").val(),
                                'title': $("[name='title']").val(),
                                'content': $("[name='content']").val(),
                                'type.id': $("[name='type.id']").val(),
                                'tagIds': $("[name='tagIds']").val(),
                                'taskDate': $("[name='taskDate']").val(),
                                'repeat': $("[name='repeat']").prop("checked"),
                                'interval': $("[name='m_interval']").val(),
                                'totalTimes': $("[name='total_times']").val()
                            }, function (responseTxt, statusTxt, xhr) {
                                //callback 回调方法
                                //判断是否成功，刷新，滚动到comment头
                                $(window).scrollTo($('#todo_container'), 500);
                                clearContent();
                            });
                        }

                        //表单验证
                        $('#todo-form').form({
                            fields: {
                                title: {
                                    identifier: 'title',
                                    rules: [{
                                        type: 'empty',
                                        prompt: '标题：请输入待办标题'
                                    }]
                                },
                                content: {
                                    identifier: 'content',
                                    rules: [{
                                        type: 'empty',
                                        prompt: '内容：请输入待办内容'
                                    }]
                                },
                                typeId: {
                                    identifier: 'type.id',
                                    rules: [{
                                        type: 'empty',
                                        prompt: '分类：请选择分类'
                                    }]
                                },
                                m_interval: {
                                    identifier: 'm_interval',
                                    rules: [{
                                        type: 'integer[1..65535]',
                                        prompt: '间隔：只能输入1~65535间的数字哦'
                                    }]
                                },
                                total_times: {
                                    identifier: 'total_times',
                                    rules: [{
                                        type: 'integer[-1..65535]',
                                        prompt: '重复次数：只能输入-1~65535间的数字哦'
                                    }]
                                }
                            }
                        });

                        //获取当前日期
                        function getdate() {
                            var time = new Date();
                            var day = ("0" + time.getDate()).slice(-2);
                            var month = ("0" + (time.getMonth() + 1)).slice(-2);
                            var today = time.getFullYear() + "-" + (month) + "-" + (day);
                            return today;
                        }

                        //根据日期查待办选择的日期
                        $('#query_date').val(getdate()).change(function () {
                            console.log($('#query_date').val());
                        });


                        //当选中的为复习时
                        $("#review_item").on("click", function () {
                            $('#repeat').prop("checked", false).prop("disabled", true);
                            repeatChange();
                        });
                        //当选中的为待办时
                        $("#todo_item").on("click", function () {
                            $('#repeat').prop("disabled", false);
                            repeatChange();
                        });
                        //点击新建待办按钮之后的事件
                        $('#create_todo_btn').on("click", function () {
                            $('.ui.add.dropdown').dropdown();
                            var status = document.getElementById("create_todo_form").style.display;
                            console.log($("#todo_or_review_input").val());
                            if (status == "none") {
                                document.getElementById("create_todo_btn").innerText = "放弃新增";
                                document.getElementById("create_todo_form").style.display = "";
                                document.getElementById("edit_todo_form").style.display = "none";
                                $('#taskDate').val(getdate());
                            } else {
                                document.getElementById("create_todo_btn").innerText = "新增待办";
                                document.getElementById("create_todo_form").style.display = "none";
                            }
                        });
                        //多选框“重复”被选中后 TODO 改成switch样式会好看点
                        $('#repeat').change(function () {
                            repeatChange();
                        });

                        //勾选重复之后的操作
                        function repeatChange() {
                            if ($('#repeat').prop('checked')) {
                                document.getElementById("repeat_input").style.display = "";
                                document.getElementById('total_times_div').classList.add("required");
                                document.getElementById('m_interval_div').classList.add("required");
                            } else {
                                document.getElementById("repeat_input").style.display = "none";
                                document.getElementById('total_times_div').classList.remove("required");
                                document.getElementById('m_interval_div').classList.remove("required");
                            }
                        }

                        //点击提交添加后，进行表单校验后，传送数据
                        $('#add-btn').click(function () {
                            $('#todo-form').form('validate form');
                            var boo = $('#todo-form').form('is valid');
                            // var boo = $('.ui.form').form('validate field(todo_container)');
                            if (boo) {
                                console.log("校验成功");
                                postData();
                            } else {
                                console.log("校验失败");
                            }
                        });

                        //表单恢复默认值
                        function clearContent() {
                            $("[name='id']").val("");
                            $("[name='flag']").val("待办");
                            $("[name='title']").val("");
                            $("[name='content']").val("");
                            $("[name='type.id']").val("");
                            $("[name='tagIds']").val("");
                            $("[name='repeat']").prop("checked",false);
                            $("[name='m_interval']").val(1);
                            $("[name='total_times']").val(5);
                        }

                        function isFinish(obj) {
                            // 判断，是待办，则显示model，提示是否完成
                            // 是复习，则显示popup，3个按钮打分，获取id、打分内容、进行更新$(obj).data('id')
                            if($(obj).data('flag') == "待办"){
                                $('.ui.modal')
                                    .modal({
                                        onDeny    : function(){
                                            console.log("用户点击取消");
                                        },
                                        onApprove : function() {
                                            // window.alert('Approved!');
                                            // 传请求，根据id更新待办，return “_todo:: todoList"
                                            console.log($(obj).data("id"));
                                            postFinish($(obj).data("id"));
                                        }
                                    })
                                    .modal('show')
                                ;
                            }else if($(obj).data('flag') == "复习"){
                                console.log("复习");
                            }else{
                                window.alert('既不是待办也不是复习！！！');
                            }
                        }
                        function postFinish(id){
                            console.log("id"+id);
                        }

                        function postRating(id, rate) {
                            console.log("id="+id);
                            console.log("rate="+rate);
                        }
                    </script>
                    <!--顶部日期选择-->
                    <div class="ui segment">
                        <div class="ui middle aligned three column grid">
                            <div class="column">
                                <a class="ui mini teal basic button" href="javascript:;">前一日</a>
                            </div>
                            <div class="center aligned column">
                                <input id="query_date" type="date">
                            </div>
                            <div class="right aligned column">
                                <a class="ui mini teal basic button" href="javascript:;">前一日</a>
                            </div>
                        </div>
                    </div>
                    <!--确认对话框-->
                    <div class="ui modal">
                        <div class="ui header">
                            本条待办已经完成？
                        </div>
                        <div class="content">
                            <p>点击 ’确定‘ 后，此待办将进入已完成列表，不可撤销！</p>
                        </div>
                        <div class="actions">
                            <div class="ui red cancel inverted button">
                                <i class="remove icon"></i>
                                取消
                            </div>
                            <div class="ui green ok inverted button">
                                <i class="checkmark icon"></i>
                                确定
                            </div>
                        </div>
                    </div>
                    <!--今日未完成标题-->
                    <div class="ui red top attached segment">
                        <div class="ui middle aligned two column grid">
                            <div class="column">
                                <h3 class="ui orange header">今日未完成</h3>
                            </div>
                            <div class="right aligned column">
                                <!--h是block元素，所以会直接换行,这里自定义m-inline-block-->
                                共 <h2 class="ui orange header m-inline-block m-text-thin"
                                      th:text="${todos}!=null ? ${todos.size}:0">
                                14 </h2> 个
                            </div>
                        </div>
                    </div>
                    <!--今日未完成内容-->
                    <div class="ui attached segment">
                        <div class="ui raised attached segment" th:each="todo : ${todos}">
                            <input type="hidden" name="eachTodoId" th:value="${todo.id}">
                            <!-- TODO这里可以改一下逻辑，TODO类加一个不存数据库的遗留属性，如果是遗留，在返回List的时候，这个属性=true，如果不是遗留，就=false-->
                            <div class="ui ribbon label" th:text="(${todo.isRemain}?'遗留的':'')+${todo.flag}" th:classappend="${todo.flag}=='复习'?'olive':'teal'">遗留的复习</div>
                            <strong th:text="${todo.title}">待复习的主题</strong>
                            <p th:text="${todo.content}">待复习的细节，第一点，今天背了xxxxx。第二点，今天写了xxxxx。第三点，今天xxxxxx了，等等。
                                待复习的细节，第一点，今天背了xxxxx。第二点，今天写了xxxxx。第三点，今天xxxxxx了，等等。</p>
                            <div class="ui mobile stackable grid">
                                <div class="row">
                                    <div class="eight wide column">
                                        <label class="ui m-padded-tb-small basic blue label" th:text="${todo.type.name}">类型</label>
                                        <label class="ui m-padded-tb-small basic teal left pointing label"
                                               th:each="tag : ${todo.tags}"
                                               th:text="${tag.name}">标签1</label>
                                        <!--/*-->
                                        <label class="ui m-padded-tb-small left pointing label">标签2</label>
                                        <!--*/-->
                                    </div>
                                    <div class="right aligned eight wide column">
                                        <div class="ui buttons">
                                            <a href="javascript:;" class="ui basic blue m-padded-tb-small button"
                                               data-id="1" data-flag="复习" data-title="标题" data-content="内容" data-createtime="2021-04-10 xx:xx:xx"
                                               data-updatetime="2021-04-10 xx:xx:xx" data-finisheddate="2021-04-10" data-taskdate="2021-04-10"
                                               data-interval="1" data-totaltimes="5" data-remaintimes="5" data-easinessfactor="2.0" data-tagids="1,2,3"
                                               data-repeat="true" data-typeid="10"
                                               th:attr="data-id=${todo.id}, data-flag=${todo.flag}, data-title=${todo.title}, data-content=${todo.content},
                                                data-createtime=${todo.createTime}, data-updatetime=${todo.updateTime}, data-finisheddate=${todo.finishedDate},
                                                data-taskdate=${todo.taskDate}, data-interval=${todo.interval}, data-totaltimes=${todo.totalTimes},
                                                data-remaintimes=${todo.remainTimes}, data-easinessfactor=${todo.easinessFactor}, data-tagids=${todo.tagIds},
                                                data-repeat=${todo.repeat}, data-typeid=${todo.type.id}"
                                               onclick="editTodo(this)">编辑</a>

                                            <button href="javascript:;" th:id="finbtn+${todo.id}" onclick="isFinish(this)"
                                                    th:attr="data-id=${todo.id}, data-flag=${todo.flag}"
                                                    class="ui finbtn basic positive m-padded-tb-small button"
                                                    th:attrappend="data-html=${todo.flag}==复习 ? |<div class='header'>评价：${todo.id}</div>
                                                                <div class='content'>
                                                                    <div class='ui buttons'>
                                                                        <a href='javascript:console.log(${todo.id}_2);' onclick='postRating(${todo.id},2)' class='ui m-padded-tiny basic red button'>不熟</a>
                                                                        <a href='javascript:console.log(${todo.id}_4);' onclick='postRating(${todo.id},4)' class='ui m-padded-tiny basic blue button'>一般</a>
                                                                        <a href='javascript:console.log(${todo.id}_6);' onclick='postRating(${todo.id},6)' class='ui m-padded-tiny basic green button'>很熟</a>
                                                                    </div>
                                                                </div>|"
                                                    >完成</button>
                                            <a href="javascript:;" class="ui basic negative m-padded-tb-small button" th:href="@{/todos/{id}/delete(id=${todo.id})}">删除</a>
                                            <script>
                                                // $('ui[data-html], i[title], i[data-content], i[data-html]').popup()
                                                // console.log($('.ui[data-html]'));
                                                // 保证复习按钮的弹出
                                                $('.ui[data-html]')
                                                    .popup({
                                                        on: 'click'
                                                    });

                                            </script>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--/*-->
                        <div class="ui raised attached segment">
                            <div class="ui red ribbon label">遗留的复习</div>
                            <strong>待复习的主题</strong>
                            <p>待复习的细节，第一点，今天背了xxxxx。第二点，今天写了xxxxx。第三点，今天xxxxxx了，等等。
                                待复习的细节，第一点，今天背了xxxxx。第二点，今天写了xxxxx。第三点，今天xxxxxx了，等等。</p>
                            <div class="ui mobile stackable grid">
                                <div class="row">
                                    <div class="eight wide column">
                                        <label href="javascript:;" class="ui m-padded-tb-small label">类型</label>
                                        <label href="javascript:;" class="ui m-padded-tb-small left pointing label">标签1</label>
                                        <label href="javascript:;" class="ui m-padded-tb-small left pointing label">标签2</label>
                                    </div>
                                    <div class="right aligned eight wide column">
                                        <div class="ui buttons">
                                            <button href="javascript:;" class="ui basic blue m-padded-tb-small button">编辑</button>
                                            <button href="javascript:;" class="ui basic positive m-padded-tb-small button">完成</button>
                                            <button href="javascript:;" class="ui basic negative m-padded-tb-small button">删除
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="ui raised attached segment">
                            <div class="ui pink ribbon label">遗留的待办</div>
                            <strong>待办的主题</strong>
                            <p>待办的细节，第一点，今天背了xxxxx。第二点，今天写了xxxxx。第三点，今天xxxxxx了，等等。
                                待办的细节，第一点，今天背了xxxxx。第二点，今天写了xxxxx。第三点，今天xxxxxx了，等等。</p>
                            <div class="ui mobile stackable grid">
                                <div class="row">
                                    <div class="eight wide column">
                                        <label href="javascript:;" class="ui m-padded-tb-small label">类型</label>
                                        <label href="javascript:;" class="ui m-padded-tb-small left pointing label">标签1</label>
                                        <label href="javascript:;" class="ui m-padded-tb-small left pointing label">标签2</label>
                                    </div>
                                    <div class="right aligned eight wide column">
                                        <div class="ui buttons">
                                            <button href="javascript:;" class="ui basic blue m-padded-tb-small button">编辑</button>
                                            <button href="javascript:;" class="ui basic positive m-padded-tb-small button">完成
                                            </button>
                                            <button href="javascript:;" class="ui basic negative m-padded-tb-small button">删除
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="ui raised attached segment">
                            <div class="ui olive ribbon label">复习</div>
                            <strong>待复习的主题</strong>
                            <p>待复习的细节，第一点，今天背了xxxxx。第二点，今天写了xxxxx。第三点，今天xxxxxx了，等等。
                                待复习的细节，第一点，今天背了xxxxx。第二点，今天写了xxxxx。第三点，今天xxxxxx了，等等。</p>
                            <div class="ui mobile stackable grid">
                                <div class="row">
                                    <div class="eight wide column">
                                        <label href="javascript:;" class="ui m-padded-tb-small label">类型</label>
                                        <label href="javascript:;" class="ui m-padded-tb-small left pointing label">标签1</label>
                                        <label href="javascript:;" class="ui m-padded-tb-small left pointing label">标签2</label>
                                    </div>
                                    <div class="right aligned eight wide column">
                                        <div class="ui buttons">
                                            <button href="javascript:;" class="ui basic blue m-padded-tb-small button">编辑</button>
                                            <button href="javascript:;" class="ui basic positive m-padded-tb-small button">完成
                                            </button>
                                            <button href="javascript:;" class="ui basic negative m-padded-tb-small button">删除
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="ui raised attached segment">
                            <div class="ui teal ribbon label">待办</div>
                            <strong>待办的主题</strong>
                            <p>待办的细节，第一点，今天背了xxxxx。第二点，今天写了xxxxx。第三点，今天xxxxxx了，等等。
                                待办的细节，第一点，今天背了xxxxx。第二点，今天写了xxxxx。第三点，今天xxxxxx了，等等。</p>
                            <div class="ui mobile stackable grid">
                                <div class="row">
                                    <div class="eight wide column">
                                        <label href="javascript:;" class="ui m-padded-tb-small label">类型</label>
                                        <label href="javascript:;" class="ui m-padded-tb-small left pointing label">标签1</label>
                                        <label href="javascript:;" class="ui m-padded-tb-small left pointing label">标签2</label>
                                    </div>
                                    <div class="right aligned eight wide column">
                                        <div class="ui buttons">
                                            <button href="javascript:;" class="ui basic blue m-padded-tb-small button">编辑</button>
                                            <button href="javascript:;" class="ui basic positive m-padded-tb-small button">完成
                                            </button>
                                            <button href="javascript:;" class="ui basic negative m-padded-tb-small button">删除
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--*/-->
                    </div>
                    <!--新增待办按钮-->
                    <div class="ui attached segment">
                        <button id="create_todo_btn" class="ui basic blue fluid button">新增待办</button>
                    </div>
                    <!--新增的表单-->
                    <div id="create_todo_form" class="ui attached segment" style="display: none;">
                        <div class="ui container">
                            <div id="todo-form" class="ui form">
                                <input type="hidden" name="id">
                                <input type="hidden" name="createTime">
                                <!--            <input type="hidden" name="updateTime" th:value="*{updateTime}">-->
                                <div class="required field">
                                    <div class="ui left labeled input">
                                        <div class="ui add selection compact teal basic dropdown label">
                                            <input id="todo_or_review_input" type="hidden" name="flag" value="待办">
                                            <i class="dropdown icon"></i>
                                            <div class="text">待办</div>
                                            <div class="menu">
                                                <label id="review_item" class="item" data-value="复习">复习</label>
                                                <label id="todo_item" class="item" data-value="待办">待办</label>
                                            </div>
                                        </div>
                                        <input type="text" name="title" placeholder="标题">
                                    </div>
                                </div>
                                <div class="required field">
                                    <div>
                                        <textarea name="content" placeholder="请输入待办内容"></textarea>
                                    </div>
                                </div>
                                <div class="required field">
                                    <div class="ui left labeled input">
                                        <label class="ui compact teal basic label">分类</label>
                                        <div class="ui add fluid selection dropdown">
                                            <input type="hidden" name="type.id">
                                            <i class="dropdown icon"></i>
                                            <div class="default text">分类</div>
                                            <div class="menu">
                                                <div th:each="type : ${types}" class="item" data-value="1"
                                                     th:data-value="${type.id}" th:text="${type.name}">错误日志
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="field">
                                    <div class="ui left labeled input">
                                        <label class="ui compact teal basic label">标签</label>
                                        <div class="ui add fluid selection multiple search dropdown">
                                            <input type="hidden" name="tagIds">
                                            <i class="dropdown icon"></i>
                                            <div class="default text">标签</div>
                                            <div class="menu">
                                                <div th:each="tag : ${tags}" class="item" data-value="1"
                                                     th:data-value="${tag.id}" th:text="${tag.name}">Java
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="two fields">
                                    <div class="required field">
                                        <input id="taskDate" type="date" name="taskDate" value=""/>
                                    </div>
                                    <div class="inline fields">
                                        <div id="repeat_div" class="center aligned field">
                                            <div class="ui checkbox">
                                                <input id="repeat" type="checkbox" name="repeat" class="hidden">
                                                <label for="repeat">重复</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div id="repeat_input" class="two fields" style="display: none;">
                                    <div id="m_interval_div" class="field">
                                        <div class="ui left labeled input">
                                            <label class="ui teal basic label">间隔天数</label>
                                            <input id="m_interval" type="number" name="m_interval" value="1"/>
                                        </div>
                                        <p>间隔天数应为正整数，当其为1时，代表每天都有此待办。</p>
                                    </div>
                                    <div id="total_times_div" class="field">
                                        <div class="ui left labeled input">
                                            <label class="ui teal basic label">重复次数</label>
                                            <input id="total_times" type="number" name="total_times" value="5"/>
                                        </div>
                                        <p>重复次数为-1时，此待办永不停止，为0则代表此项已完成。</p>
                                    </div>
                                </div>
                                <div class="ui error message"></div>
                                <div class="ui right aligned container">
                                    <!--若不指定type=button，则默认为submit-->
                                    <button type="button" id="add-btn" class="ui basic primary button">添加</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--修改的表单-->
                    <script  th:inline="javascript">
                        //表单验证
                        $('#edit_todo_form').form({
                            fields: {
                                edit_title: {
                                    identifier: 'edit_title',
                                    rules: [{
                                        type: 'empty',
                                        prompt: '标题：请输入待办标题'
                                    }]
                                },
                                edit_content: {
                                    identifier: 'edit_content',
                                    rules: [{
                                        type: 'empty',
                                        prompt: '内容：请输入待办内容'
                                    }]
                                },
                                edit_typeId: {
                                    identifier: 'edit_type.id',
                                    rules: [{
                                        type: 'empty',
                                        prompt: '分类：请选择分类'
                                    }]
                                },
                                edit_m_interval: {
                                    identifier: 'edit_m_interval',
                                    rules: [{
                                        type: 'integer[1..65535]',
                                        prompt: '间隔：只能输入1~65535间的数字哦'
                                    }]
                                },
                                edit_total_times: {
                                    identifier: 'edit_total_times',
                                    rules: [{
                                        type: 'integer[-1..65535]',
                                        prompt: '间隔只能输入-1~65535间的数字哦'
                                    }]
                                }
                            }
                        });
                        //多选框“重复”被选中后 TODO 改成switch样式会好看点
                        $('#edit_repeat').change(function () {
                            edit_repeatChange();
                        });
                        //勾选重复之后的操作
                        function edit_repeatChange() {
                            if ($('#edit_repeat').prop('checked')) {
                                document.getElementById("edit_repeat_input").style.display = "";
                                document.getElementById('edit_total_times_div').classList.add("required");
                                document.getElementById('edit_m_interval_div').classList.add("required");
                            } else {
                                document.getElementById("edit_repeat_input").style.display = "none";
                                document.getElementById('edit_total_times_div').classList.remove("required");
                                document.getElementById('edit_m_interval_div').classList.remove("required");
                            }
                        }


                        //点击提交添加后，进行表单校验后，传送数据
                        $('#edit-submit-btn').click(function () {
                            $('#edit_todo_form').form('validate form');
                            var boo = $('#edit_todo_form').form('is valid');
                            if (boo) {
                                console.log("校验成功");
                                postEditData();
                            } else {
                                console.log("校验失败");
                            }
                        });

                        //ajax发送请求
                        function postEditData() {
                            //第一个参数是请求的地址，第二个参数（代码块）填写相关的参数，这些参数会提交
                            $('#todo_container').load(/*[[@{/todos}]]*/+"", {
                                'id': $("[name='edit_id']").val(),
                                'flag': $("[name='edit_flag']").val(),
                                'title': $("[name='edit_title']").val(),
                                'content': $("[name='edit_content']").val(),
                                'type.id': $("[name='edit_type.id']").val(),
                                'tagIds': $("[name='edit_tagIds']").val(),
                                'taskDate': $("[name='edit_taskDate']").val(),
                                'repeat': $("[name='edit_repeat']").prop("checked"),
                                'interval': $("[name='edit_m_interval']").val(),
                                'totalTimes': $("[name='edit_total_times']").val(),
                                'createTime': $("[name='edit_createtime']").val()
                            }, function (responseTxt, statusTxt, xhr) {
                                //callback 回调方法
                                //判断是否成功，刷新，滚动到comment头
                                $(window).scrollTo($('#todo_container'), 500);
                                clearEditContent();
                            });
                        }
                        //表单恢复默认值
                        function clearEditContent() {
                            $("[name='edit_id']").val("");
                            $("[name='edit_flag']").val("待办");
                            $("[name='edit_title']").val("");
                            $("[name='edit_content']").val("");
                            $("[name='edit_type.id']").val("");
                            $("[name='edit_tagIds']").val("");
                            $("[name='edit_repeat']").prop("checked",false);
                            edit_repeatChange();
                            $("[name='edit_m_interval']").val(1);
                            $("[name='edit_total_times']").val(5);
                        }
                        function editTodo(obj) {
                            document.getElementById("create_todo_btn").innerText = "新增待办";
                            document.getElementById("create_todo_form").style.display = "none";
                            document.getElementById("edit_todo_form").style.display = "";
                            $("[name='edit_id']").val($(obj).data('id'));
                            $("[name='edit_flag']").val($(obj).data('flag'));
                            $("#edit_todo_or_review_text").text($(obj).data('flag')).val($(obj).data('flag'));
                            $("[name='edit_title']").val($(obj).data('title'));
                            $("[name='edit_content']").val($(obj).data('content')).focus();
                            $('.ui.edit.dropdown').dropdown('clear');
                            $("[name='edit_type.id']").val($(obj).data('typeid'));
                            $("[name='edit_tagIds']").val($(obj).data('tagids'));
                            $('.ui.dropdown').dropdown();
                            $('#edit_tags_dropdown').dropdown();
                            if($(obj).data('flag')=="复习"){
                                $("[name='edit_repeat']").prop("checked",false).addClass("disabled");
                            }else{
                                $("[name='edit_repeat']").prop("checked",$(obj).data('repeat'));
                            }
                            edit_repeatChange();
                            $("[name='edit_m_interval']").val(Math.round($(obj).data('interval')));
                            $("[name='edit_total_times']").val($(obj).data('totaltimes'));
                            $("[name='edit_taskDate']").val($(obj).data('taskdate'));
                            //额外赋值操作
                            // $("[name='edit_type.name']").text($(obj).data('typename')).removeClass("default");

                            //隐含域
                            $("[name='edit_createtime']").val($(obj).data('createtime'));
                            $("[name='edit_updatetime']").val($(obj).data('updatetime'));
                            $("[name='edit_finisheddate']").val($(obj).data('finisheddate'));
                            $("[name='edit_easinessfactor']").val($(obj).data('easinessfactor'));
                            $("[name='edit_remainTimes']").val($(obj).data('remaintimes'));
                            $(window).scrollTo($('#edit_todo_form'), 500);
                        }
                        $('#edit-drop-btn').click(function () {
                            clearEditContent();
                            document.getElementById("edit_todo_form").style.display = "none";
                        });
                    </script>
                    <div id="edit_todo_form" class="ui attached segment" style="display: none;">
                        <div class="ui container">
                            <div id="edit-form" class="ui form">
                                <input type="hidden" name="edit_id" placeholder="id">
                                <input type="hidden" name="edit_createtime" placeholder="createtime">
                                <input type="hidden" name="edit_updatetime" placeholder="updatetime">
                                <input type="hidden" name="edit_finisheddate"  placeholder="finisheddate">
                                <input type="hidden" name="edit_easinessfactor"  placeholder="easinessfactor">
                                <input type="hidden" name="edit_remainTimes"  placeholder="remainTimes">
                                <div class="required field">
                                    <div class="ui left labeled input">
                                        <!--flag不可更改-->
                                        <div class="ui compact grey basic label">
                                            <input id="edit_todo_or_review_input" type="hidden" name="edit_flag" value="待办">
                                            <div id="edit_todo_or_review_text" class="text">待办</div>
                                        </div>
                                        <input type="text" name="edit_title" placeholder="标题">
                                    </div>
                                </div>
                                <div class="required field">
                                    <div>
                                        <textarea name="edit_content" placeholder="请输入待办内容"></textarea>
                                    </div>
                                </div>
                                <div class="required field">
                                    <div class="ui left labeled input">
                                        <label class="ui compact teal basic label">分类</label>
                                        <div class="ui edit fluid selection dropdown">
                                            <input type="hidden" name="edit_type.id">
                                            <i class="dropdown icon"></i>
                                            <div name="edit_type.name" class="default text">分类</div>
                                            <div class="menu">
                                                <div th:each="type : ${types}" class="item" data-value="1"
                                                     th:data-value="${type.id}" th:text="${type.name}">错误日志
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="field">
                                    <div class="ui left labeled input">
                                        <label class="ui compact teal basic label">标签</label>
                                        <div id="edit_tags_dropdown" class="ui edit fluid selection multiple search dropdown">
                                            <input type="hidden" name="edit_tagIds">
                                            <i class="dropdown icon"></i>
                                            <div class="default text">标签</div>
                                            <div class="menu">
                                                <div th:each="tag : ${tags}" class="item" data-value="1"
                                                     th:data-value="${tag.id}" th:text="${tag.name}">Java
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="two fields">
                                    <div class="required field">
                                        <input id="edit_taskDate" type="date" name="edit_taskDate" value=""/>
                                    </div>
                                    <div class="inline fields">
                                        <div id="edit_repeat_div" class="center aligned field">
                                            <div class="ui checkbox">
                                                <input id="edit_repeat" type="checkbox" name="edit_repeat" class="hidden">
                                                <label for="edit_repeat">重复</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div id="edit_repeat_input" class="two fields" style="display: none;">
                                    <div id="edit_m_interval_div" class="field">
                                        <div class="ui left labeled input">
                                            <label class="ui teal basic label">间隔天数</label>
                                            <input id="edit_m_interval" type="number" name="edit_m_interval" value="1"/>
                                        </div>
                                        <p>间隔天数应为正整数，当其为1时，代表每天都有此待办。</p>
                                    </div>
                                    <div id="edit_total_times_div" class="field">
                                        <div class="ui left labeled input">
                                            <label class="ui teal basic label">重复次数</label>
                                            <input id="edit_total_times" type="number" name="edit_total_times" value="5"/>
                                        </div>
                                        <p>重复次数为-1时，此待办永不停止，为0则代表此项已完成。</p>
                                    </div>
                                </div>
                                <div class="ui error message"></div>

                                <div class="ui right aligned container">
                                    <!--若不指定type=button，则默认为submit-->
                                    <button type="button" id="edit-drop-btn" class="ui basic secondary button">放弃修改</button>
                                    <button type="button" id="edit-submit-btn" class="ui basic primary button">提交修改</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!--为了统计方便，必须将待办分为两个list，已完成与未完成，后台查询list，进行分类即可-->
                    <!--今日已完成的标题-->
                    <div class="ui green top attached m-margin-top-large segment">
                        <div class="ui middle aligned two column grid">
                            <div class="column">
                                <h3 class="ui green header">今日已完成</h3>
                            </div>
                            <div class="right aligned column">
                                <!--h是block元素，所以会直接换行,这里自定义m-inline-block-->
                                共 <h2 class="ui green header m-inline-block m-text-thin">
                                14 </h2> 个
                            </div>
                        </div>
                    </div>
                    <!--已完成的内容-->
                    <div class="ui attached segment">
                        <div class="ui raised attached segment">
                            <div class="ui green ribbon label">复习</div><!--复习or待办-->
                            <strong>待复习的主题</strong>
                            <p>待复习的细节，第一点，今天背了xxxxx。第二点，今天写了xxxxx。第三点，今天xxxxxx了，等等。
                                待复习的细节，第一点，今天背了xxxxx。第二点，今天写了xxxxx。第三点，今天xxxxxx了，等等。</p>
                            <div class="ui mobile stackable grid">
                                <div class="row">
                                    <div class="eight wide column">
                                        <label href="javascript:;" class="ui m-padded-tb-small label">类型</label>
                                        <label href="javascript:;" class="ui m-padded-tb-small left pointing label">标签1</label>
                                        <label href="javascript:;" class="ui m-padded-tb-small left pointing label">标签2</label>
                                    </div>
                                    <div class="right aligned eight wide column">
                                        <div class="ui buttons">
                                            <button href="javascript:;" class="ui basic blue m-padded-tb-small button">编辑</button>
                                            <button href="javascript:;" class="ui basic disabled m-padded-tb-small button">已完成
                                            </button>
                                            <button href="javascript:;" class="ui basic negative m-padded-tb-small button">删除
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--/*-->
                        <div class="ui raised attached segment">
                            <div class="ui green ribbon label">复习</div>
                            <strong>待复习的主题</strong>
                            <p>待复习的细节，第一点，今天背了xxxxx。第二点，今天写了xxxxx。第三点，今天xxxxxx了，等等。
                                待复习的细节，第一点，今天背了xxxxx。第二点，今天写了xxxxx。第三点，今天xxxxxx了，等等。</p>
                            <div class="ui mobile stackable grid">
                                <div class="row">
                                    <div class="eight wide column">
                                        <label href="javascript:;" class="ui m-padded-tb-small label">类型</label>
                                        <label href="javascript:;" class="ui m-padded-tb-small left pointing label">标签1</label>
                                        <label href="javascript:;" class="ui m-padded-tb-small left pointing label">标签2</label>
                                    </div>
                                    <div class="right aligned eight wide column">
                                        <div class="ui buttons">
                                            <button href="javascript:;" class="ui basic blue m-padded-tb-small button">编辑</button>
                                            <button href="javascript:;"
                                                    class="ui basic disabled positive m-padded-tb-small button">
                                                完成
                                            </button>
                                            <button href="javascript:;" class="ui basic negative m-padded-tb-small button">删除
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="ui raised attached segment">
                            <div class="ui green ribbon label">待办</div>
                            <strong>待办的主题</strong>
                            <p>待办的细节，第一点，今天背了xxxxx。第二点，今天写了xxxxx。第三点，今天xxxxxx了，等等。
                                待办的细节，第一点，今天背了xxxxx。第二点，今天写了xxxxx。第三点，今天xxxxxx了，等等。</p>
                            <div class="ui mobile stackable grid">
                                <div class="row">
                                    <div class="eight wide column">
                                        <label href="javascript:;" class="ui m-padded-tb-small label">类型</label>
                                        <label href="javascript:;" class="ui m-padded-tb-small left pointing label">标签1</label>
                                        <label href="javascript:;" class="ui m-padded-tb-small left pointing label">标签2</label>
                                    </div>
                                    <div class="right aligned eight wide column">
                                        <div class="ui buttons">
                                            <button href="javascript:;" class="ui basic blue m-padded-tb-small button">编辑</button>
                                            <button href="javascript:;"
                                                    class="ui basic disabled positive m-padded-tb-small button">
                                                完成
                                            </button>
                                            <button href="javascript:;" class="ui basic negative m-padded-tb-small button">删除
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--*/-->
                    </div>

                </div>
            </div>


            <!--右边的TOP-->
            <div class="five wide column">
                <!-- 分类 -->
                <div class="ui segments">
                    <div class="ui secondary segment">
                        <div class="ui two column grid">
                            <div class="column">
                                <i class="idea icon"></i>分类
                            </div>
                            <div class="right aligned column">
                                <a href="javascript:;" target="_blank" th:href="@{/types/-1}">more <i
                                        class=" icon angle double right"></i></a>
                            </div>
                        </div>
                    </div>
                    <div class="ui teal segment">
                        <!--未填充满，加fluid-->
                        <div class="ui fluid vertical menu">
                            <a class="item" target="_blank" href="javascript:;" th:href="@{/types/{id}(id=${type.id})}"
                               th:each="type : ${types}">
                                <span th:text="${type.name}">学习日志</span>
                                <!--#arrays.length集合长度-->
                                <div class="ui teal basic left pointing label" th:text="${#arrays.length(type.blogs)}">
                                    13
                                </div>
                            </a>
                            <!--/*-->
                            <a class="item" href="javascript:;">
                                学习日志
                                <div class="ui teal basic left pointing label">13</div>
                            </a>
                            <a class="item" href="javascript:;">
                                学习日志
                                <div class="ui teal basic left pointing label">13</div>
                            </a>
                            <a class="item" href="javascript:;">
                                学习日志
                                <div class="ui teal basic left pointing label">13</div>
                            </a>
                            <a class="item" href="javascript:;">
                                学习日志
                                <div class="ui teal basic left pointing label">13</div>
                            </a>
                            <a class="item" href="javascript:;">
                                学习日志
                                <div class="ui teal basic left pointing label">13</div>
                            </a>
                            <!--*/-->
                        </div>
                    </div>
                </div>
                <!--标签-->
                <div class="ui segments">
                    <div class="ui secondary segment">
                        <div class="ui two column grid">
                            <div class="column">
                                <i class="tags icon"></i>标签
                            </div>
                            <div class="right aligned column">
                                <a href="javascript:;" target="_blank" th:href="@{/tags/-1}">more <i
                                        class=" icon angle double right"></i></a>
                            </div>
                        </div>
                    </div>
                    <div class="ui teal segment">
                        <a class="ui teal basic left pointing label m-margin-tb-tiny" href="javascript:;" target="_blank"
                           th:href="@{/tags/{id}(id=${tag.id})}" th:each="tag : ${tags}">
                            <span th:text="${tag.name}">方法论</span>
                            <!--挖坑，老师用的是#arrays.length()，我试试能不能直接size-->
                            <div class="detail" th:text="${tag.blogs.size}">13</div>
                        </a>
                        <!--/*-->
                        <a class="ui teal basic left pointing label m-margin-tb-tiny" href="javascript:;" target="_blank">
                            论
                            <div class="detail">13</div>
                        </a>
                        <a class="ui teal basic left pointing label m-margin-tb-tiny" href="javascript:;" target="_blank">
                            方
                            <div class="detail">13</div>
                        </a>
                        <a class="ui teal basic left pointing label m-margin-tb-tiny" href="javascript:;" target="_blank">
                            法
                            <div class="detail">13</div>
                        </a>
                        <a class="ui teal basic left pointing label m-margin-tb-tiny" href="javascript:;" target="_blank">
                            方法论
                            <div class="detail">13</div>
                        </a>
                        <a class="ui teal basic left pointing label m-margin-tb-tiny" href="javascript:;" target="_blank">
                            方法论
                            <div class="detail">13</div>
                        </a>
                        <a class="ui teal basic left pointing label m-margin-tb-tiny" href="javascript:;" target="_blank">
                            方法论
                            <div class="detail">13</div>
                        </a>
                        <a class="ui teal basic left pointing label m-margin-tb-tiny" href="javascript:;" target="_blank">
                            方法论
                            <div class="detail">13</div>
                        </a>
                        <a class="ui teal basic left pointing label m-margin-tb-tiny" href="javascript:;" target="_blank">
                            方法论
                            <div class="detail">13</div>
                        </a>
                        <a class="ui teal basic left pointing label m-margin-tb-tiny" href="javascript:;" target="_blank">
                            方法论
                            <div class="detail">13</div>
                        </a>
                        <!--*/-->
                    </div>
                </div>

                <!--最新推荐-->
                <div class="ui segments m-margin-top-large">

                    <div class="ui secondary segment">
                        <i class="tags icon"></i>最新推荐
                    </div>
                    <div class="ui segment" th:each="blog : ${recommendBlogs}">
                        <a class="m-black m-text-thin" href="javascript:;" target="_blank" th:text="${blog.title}"
                           th:href="@{/blog/{id}(id=${blog.id})}">用户故事 (User Story)</a>
                    </div>
                    <!--/*-->
                    <div class="ui segment">
                        <a class="m-black m-text-thin" href="javascript:;" target="_blank">用户故事 (User Story)</a>
                    </div>
                    <div class="ui segment">
                        <a class="m-black m-text-thin" href="javascript:;" target="_blank">用户故事 (User Story)</a>
                    </div>
                    <div class="ui segment">
                        <a class="m-black m-text-thin" href="javascript:;" target="_blank">用户故事 (User Story)</a>
                    </div>
                    <div class="ui segment">
                        <a class="m-black m-text-thin" href="javascript:;" target="_blank">用户故事 (User Story)</a>
                    </div>
                    <div class="ui segment">
                        <a class="m-black m-text-thin" href="javascript:;" target="_blank">用户故事 (User Story)</a>
                    </div>
                    <div class="ui segment">
                        <a class="m-black m-text-thin" href="javascript:;" target="_blank">用户故事 (User Story)</a>
                    </div>
                    <div class="ui segment">
                        <a class="m-black m-text-thin" href="javascript:;" target="_blank">用户故事 (User Story)</a>
                    </div>
                    <!--*/-->
                </div>
                <!--二维码-->
                <div class="ui horizontal divider header m-margin-top-large">扫码关注我</div>
                <div class="ui centered card" style="width: 11em">
                    <img alt="" src="../static/images/wechat.jpg" class="ui rounded image"
                         th:src="@{/images/wechat.jpg}">
                </div>
            </div>
        </div>
    </div>
</div>
<br>
<br>
<!--底部footer 为了保证有一个原型，所以index未替换footer-->
<footer class="ui inverted vertical segment m-padded-tb-massive">
    <div class="ui center aligned container">
        <div class="ui divided inverted stackable grid">
            <div class="three wide column">
                <div class="ui inverted link list">
                    <div class="item">
                        <img alt="" class=" ui rounded image" th:src="@{/images/wechat.jpg}" style="width: 110px">
                    </div>
                </div>
            </div>
            <div class="three wide column">
                <h4 class="ui inverted header m-text-spaced m-opacity-mini">最新博客</h4>
                <div id="newblog-container">
                    <div class="ui inverted link list" th:fragment="newblogList">
                        <a class="item" href="javascript:;" target="_blank" th:href="@{/blog/{id}(id=${blog.id})}"
                           th:each="blog : ${newblogs}" th:text="${blog.title}">用户故事（User Story）</a>
                        <!--/*-->
                        <a class="item" href="javascript:;">用户故事（User Story）</a>
                        <a class="item" href="javascript:;">用户故事（User Story）</a>
                        <!--*/-->
                    </div>
                </div>
            </div>
            <div class="three wide column">
                <h4 class="ui inverted header m-text-spaced m-opacity-mini">联系我</h4>
                <div class="ui inverted link list">
                    <a class="item" href="javascript:;" th:text="|Email: #{index.email}|">Email:514754220@qq.com</a>
                    <a class="item" href="javascript:;" th:text="|QQ: #{index.qq}|">QQ:514754220</a>
                </div>
            </div>
            <div class="seven wide column">
                <h4 class="ui inverted header m-text-spaced m-opacity-mini">博客介绍</h4>
                <p class="m-text-thin m-text-spaced m-opacity-mini" th:text="#{index.introduction}">宁的家~</p>
            </div>
        </div>
        <div class="ui inverted section divider"></div>
        <p class="m-text-thin m-text-spaced m-opacity-tiny"
           th:text="|#{index.copyright}${#dates.year(#dates.createToday())}|">Copyright@......</p>
    </div>
</footer>

<script>
    $('#todo_container').load("/todos");
    //加载底部的新博客推荐
    $('#newblog-container').load("/footer/newblog");
    //当设备width过小时，顶部菜单切换为折叠样式
    $('.menu.toggle').click(function () {
        $('.m-item').toggleClass('m-mobile-hide');
    });
</script>
</body>
</html>